@model GuidanceTracker.Models.ViewModels.CreatePostViewModel

@{
    ViewBag.Title = "Create Post";
}

<div class="container my-4">
    <div class="card" style="border: 1px solid #e0e0e0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px;">
        <div class="card-header" style="color: white; background-color: #7F3D98; padding: 20px;">
            <h3 class="mb-0">Create A Post</h3>
        </div>
        <div class="card-body">
            @using (Html.BeginForm(null, null, FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                <div class="mb-3 row">
                    @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "col-md-2 col-form-label fw-bold" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control", placeholder = "Enter post title", style = "border-color: #6A1B9A;" } })
                        @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="mb-3 row">
                    @Html.LabelFor(model => model.Content, htmlAttributes: new { @class = "col-md-2 col-form-label fw-bold" })
                    <div class="col-md-10">
                        @Html.TextAreaFor(model => model.Content, new { @class = "form-control", rows = 10, placeholder = "Write your post content here...", style = "border-color: #6A1B9A;" })
                        @Html.ValidationMessageFor(model => model.Content, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="mb-3 row">
                    @Html.LabelFor(model => model.Visibility, htmlAttributes: new { @class = "col-md-2 col-form-label fw-bold" })
                    <div class="col-md-10">
                        @Html.EnumDropDownListFor(model => model.Visibility, new { @class = "form-select", id = "visibility-dropdown", style = "border-color: #6A1B9A;" })
                        @Html.ValidationMessageFor(model => model.Visibility, "", new { @class = "text-danger" })
                        <small class="form-text text-muted">Select who can see this post</small>
                    </div>
                </div>

                <div id="visibility-options">
                    <!-- Department Selection -->
                    <div class="mb-3 row visibility-option" id="department-option" style="display:none;">
                        <label class="col-md-2 col-form-label fw-bold">Department</label>
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.DepartmentId, Model.Departments, "-- Select Department --", new { @class = "form-select", style = "border-color: #6A1B9A;" })
                        </div>
                    </div>

                    <!-- Course Selection -->
                    <div class="mb-3 row visibility-option" id="course-option" style="display:none;">
                        <label class="col-md-2 col-form-label fw-bold">Course</label>
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.CourseId, Model.Courses, "-- Select Course --", new { @class = "form-select", style = "border-color: #6A1B9A;" })
                        </div>
                    </div>

                    <!-- Class Selection -->
                    <div class="mb-3 row visibility-option" id="class-option" style="display:none;">
                        <label class="col-md-2 col-form-label fw-bold">Class</label>
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.ClassId, Model.Classes, "-- Select Class --", new { @class = "form-select", style = "border-color: #6A1B9A;" })
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-10 offset-md-2">
                        <button type="submit" class="btn" style="background-color: #7F3D98; color: white;">
                            Save Changes
                        </button>
                        <a href="@Url.Action("ViewMyPosts", "Post")" class="btn btn-outline-secondary ms-2">
                            Back to My Posts
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            // Function to show/hide dropdowns based on selected visibility
            function updateVisibilityOptions() {
                // Hide all options first
                $('.visibility-option').hide();

                // Show appropriate dropdown based on selected visibility
                var selectedVisibility = $('#visibility-dropdown').val();

                switch (selectedVisibility) {
                    case '3': // Department
                        $('#department-option').fadeIn(300);
                        break;
                    case '4': // Course
                        $('#course-option').fadeIn(300);
                        break;
                    case '5': // Class
                        $('#class-option').fadeIn(300);
                        break;
                }
            }

            // Run on page load
            updateVisibilityOptions();

            // Run when visibility selection changes
            $('#visibility-dropdown').change(updateVisibilityOptions);

            // Add animation to form submission
            $('form').submit(function () {
                $('.btn[type="submit"]').prepend('<span class="spinner-border spinner-border-sm me-2"></span>');
                $('.btn[type="submit"]').attr('disabled', true);
            });
        });
    </script>
}